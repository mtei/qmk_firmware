#include "helix.h"
#include "split_util.h"

#ifdef SSD1306OLED
#    include "ssd1306.h"

bool process_record_kb(uint16_t keycode, keyrecord_t *record) { return process_record_gfx(keycode, record) && process_record_user(keycode, record); }

void led_set_kb(uint8_t usb_led) {
    // put your keyboard LED indicator (ex: Caps Lock LED) toggling code here
    // led_set_user(usb_led);
}
#endif

#ifdef RGB_MATRIX_ENABLE
// Physical LED layout
//
// FIXME: Doesn't handle underglow WS2812 stripes!
//
// 0  1  2  3  4  5  6    7  8  9  10 11 12 13
//                                               ROWS
// 06 05 04 03 02 01         01 02 03 04 05 06   0
// 07 08 09 10 11 12         12 11 10 09 08 07   1
// 18 17 16 15 14 13         13 14 15 16 17 18   2
// 19 20 21 22 23 24 25   25 24 23 22 21 20 19   3
// 32 31 30 29 28 27 26   26 27 28 29 30 31 32   4

// clang-format off
led_config_t g_led_config = { {
  #if MATRIX_ROWS == 8 // HELIX_ROWS == 4
    #error RGB_MATRIX_ENABLE does not yet support HELIX_ROWS == 4.
  #else
    // Key Matrix to LED Index
    {  5,  4,  3,  2,  1,  0, NO_LED, },
    {  6,  7,  8,  9, 10, 11, NO_LED, },
    { 17, 16, 15, 14, 13, 12, NO_LED, },
    { 18, 19, 20, 21, 22, 23,     24, },
    { 31, 30, 29, 28, 27, 26,     25, },
    { 37, 36, 35, 34, 33, 32, NO_LED  },
    { 38, 39, 40, 41, 42, 43, NO_LED },
    { 49, 48, 47, 46, 45, 44, NO_LED  },
    { 50, 51, 52, 53, 54, 55,     56, },
    { 63, 62, 61, 60, 59, 58,     57, },
}, {
    // LED Index to Physical Position
    {  86,  0 }, {  68,  0 }, {  51,  0 }, {  34,  0 }, {  17,  0 }, {   0,  0 }, {   0, 16 },
    {  17, 16 }, {  34, 16 }, {  51, 16 }, {  68, 16 }, {  86, 16 }, {  86, 32 }, {  68, 32 },
    {  51, 32 }, {  34, 32 }, {  17, 32 }, {   0, 32 }, {   0, 48 }, {  17, 48 }, {  34, 48 },
    {  51, 48 }, {  68, 48 }, {  86, 48 }, { 103, 48 }, { 103, 64 }, {  86, 64 }, {  68, 64 },
    {  51, 64 }, {  34, 64 }, {  17, 64 }, {   0, 64 }, { 137,  0 }, { 155,  0 }, { 172,  0 },
    { 189,  0 }, { 206,  0 }, { 224,  0 }, { 224, 16 }, { 206, 16 }, { 189, 16 }, { 172, 16 },
    { 155, 16 }, { 137, 16 }, { 137, 32 }, { 155, 32 }, { 172, 32 }, { 189, 32 }, { 206, 32 },
    { 224, 32 }, { 224, 48 }, { 206, 48 }, { 189, 48 }, { 172, 48 }, { 155, 48 }, { 137, 48 },
    { 120, 48 }, { 120, 64 }, { 137, 64 }, { 155, 64 }, { 172, 64 }, { 189, 64 }, { 206, 64 },
    { 224, 64 }
}, {
    // LED Index to Flag
    4, 4, 4, 4, 4, 1, 1,
    4, 4, 4, 4, 4, 4, 4,
    4, 4, 4, 1, 1, 4, 4,
    4, 4, 4, 4, 1, 1, 1,
    1, 1, 1, 1, 4, 4, 4,
    4, 4, 1, 1, 4, 4, 4,
    4, 4, 4, 4, 4, 4, 4,
    1, 1, 4, 4, 4, 4, 4,
    4, 1, 1, 1, 1, 1, 1,
    1,
  #endif
} };
// clang-format on
#endif

void rgb_matrix_right_hand_init(void) {
#ifdef RGB_MATRIX_ENABLE
  #if MATRIX_ROWS == 8 // HELIX_ROWS == 4
    #error RGB_MATRIX_ENABLE does not yet support HELIX_ROWS == 4.
  #else
    if (!isLeftHand) {
        // clang-format off
        g_led_config = (led_config_t){ {
            // Key Matrix to LED Index
            { 37, 36, 35, 34, 33, 32, NO_LED, },
            { 38, 39, 40, 41, 42, 43, NO_LED, },
            { 49, 48, 47, 46, 45, 44, NO_LED, },
            { 50, 51, 52, 53, 54, 55,     56, },
            { 63, 62, 61, 60, 59, 58,     57, },
            {  5,  4,  3,  2,  1,  0, NO_LED, },
            {  6,  7,  8,  9, 10, 11, NO_LED, },
            { 17, 16, 15, 14, 13, 12, NO_LED, },
            { 18, 19, 20, 21, 22, 23,     24, },
            { 31, 30, 29, 28, 27, 26,     25, },
        }, {
            // LED Index to Physical Position
            { 137,  0 }, { 155,  0 }, { 172,  0 }, { 189,  0 }, { 206,  0 }, { 224,  0 }, { 224, 16 },
            { 206, 16 }, { 189, 16 }, { 172, 16 }, { 155, 16 }, { 137, 16 }, { 137, 32 }, { 155, 32 },
            { 172, 32 }, { 189, 32 }, { 206, 32 }, { 224, 32 }, { 224, 48 }, { 206, 48 }, { 189, 48 },
            { 172, 48 }, { 155, 48 }, { 137, 48 }, { 120, 48 }, { 120, 64 }, { 137, 64 }, { 155, 64 },
            { 172, 64 }, { 189, 64 }, { 206, 64 }, { 224, 64 }, {  86,  0 }, {  68,  0 }, {  51,  0 },
            {  34,  0 }, {  17,  0 }, {   0,  0 }, {   0, 16 }, {  17, 16 }, {  34, 16 }, {  51, 16 },
            {  68, 16 }, {  86, 16 }, {  86, 32 }, {  68, 32 }, {  51, 32 }, {  34, 32 }, {  17, 32 },
            {   0, 32 }, {   0, 48 }, {  17, 48 }, {  34, 48 }, {  51, 48 }, {  68, 48 }, {  86, 48 },
            { 103, 48 }, { 103, 64 }, {  86, 64 }, {  68, 64 }, {  51, 64 }, {  34, 64 }, {  17, 64 },
            {   0, 64 }
        }, {
            // LED Index to Flag
            4, 4, 4, 4, 4, 1, 1,
            4, 4, 4, 4, 4, 4, 4,
            4, 4, 4, 1, 1, 4, 4,
            4, 4, 4, 4, 1, 1, 1,
            1, 1, 1, 1, 4, 4, 4,
            4, 4, 1, 1, 4, 4, 4,
            4, 4, 4, 4, 4, 4, 4,
            1, 1, 4, 4, 4, 4, 4,
            4, 1, 1, 1, 1, 1, 1,
            1,
        } };
        // clang-format on
    }
  #endif
#endif
}

void matrix_init_kb(void) {
    rgb_matrix_right_hand_init();
    matrix_init_user();
};
